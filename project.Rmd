---
title: "CS-E5710 Bayesian Data Analysis - PROJECT NAME HERE" # TODO: project name here
author: "Egor Eremin & Tam Nguyen"
output: 
  pdf_document:
    toc: yes
    toc_depth: 1
urlcolor: blue
editor_options: 
  markdown: 
    wrap: 72
---

```{r include=FALSE, results='hide'}
# Install/import packages
if (!require(tidybayes)) {
    install.packages("tidybayes")
    library(tidybayes)
}

if (!require(brms)) {
    install.packages("brms")
    library(brms)
}

if(!require(ggplot2)){
    install.packages("ggplot2")
    library(ggplot2)
}

if(!require(cmdstanr)){
    install.packages("cmdstanr", repos = c("https://mc-stan.org/r-packages/", getOption("repos")))
    library(cmdstanr)
}
cmdstan_installed <- function(){
  res <- try(out <- cmdstanr::cmdstan_path(), silent = TRUE)
  !inherits(res, "try-error")
}
if(!cmdstan_installed()){
    install_cmdstan()
}
```

```{r include=FALSE, results='hide'}
# General settings (e.g., seed, package options setting)
set.seed(42)
```

# 1. Introduction

## 1.1. Motivation

In recent years, the urgency of addressing climate change, particularly global warming, has become increasingly apparent. According to the European Union (EU), achieving carbon neutrality by the mid-21st century is essential to limiting global warming to manageable levels.

To tackle this global challenge, there has been a surge in efforts across various domains, including policy, technological innovation, and international cooperation. For instance, the EU has set a goal to reach carbon neutrality by 2050, while Finland aims to achieve this goal as early as 2035, followed by carbon negativity. Such objectives highlight the necessity of bold and immediate measures to transform energy systems and achieve long-term sustainability.

Renewable energy stands out as one of the most effective tools in this endeavor. A clean energy transition, with an increasing share of renewable energy in energy production and a gradual phasing out of fossil fuels, is central to the strategies of many nations and organizations. 

## 1.2. Problem definition

The CO2-equivalent emission coefficient is a measure used to quantify the carbon emissions associated with energy production. It accounts for the total greenhouse gas emissions, expressed in terms of their CO2-equivalent, per unit of energy generated. This coefficient provides a standardized way to assess and compare the carbon intensity of different energy sources, making it an essential metric for tracking progress toward carbon neutrality.

In this report, we focus on studying Finland's carbon emissions by analyzing its CO2-equivalent emission coefficient for electricity generation over the past two decades. Our aim is to understand the current state of carbon emissions in Finland, examine their historical development, and, if possible, gain insights into the future trajectory. Specifically, we want to explore whether Finland is on track to achieve its 2035 carbon neutrality goal.

Given the critical role of clean energy transition in influencing carbon emissions, we intuitively aim to incorporate data on shares of different energy productions as explanatory variables (covariates), especially production shares of renewables and fossil fuels, hoping that external factors might allow us to better explain the CO2-equivalent emission coefficient and understand the dynamics of carbon emissions in Finland's energy sector.

## 1.3. Modelling idea

Our approach to modeling the CO2-equivalent emission coefficient begins with its nature as a time-series dataset, with yearly observations spanning two decades. Therefore, the first modelling idea are about time-series models, which allow us to analyze the data in terms of trends, seasonality, and cyclical patterns. By using a time-series approach, we aim to let the data speak for itself, revealing how the CO2-equivalent emission coefficient has evolved over time and identifying patterns in its variation.

In parellel to the time-series approach, we also assume that the production shares of different energy sources significantly influence the emission coefficient. Intuitively, a high share of fossil fuel production correlates with higher CO2-equivalent emissions due to the carbon-intensive nature of fossil fuels. Conversely, an increased share of renewable energy production, which emits far less CO2, is expected to reduce the emission coefficient. This logic extends to other energy sources, such as nuclear or imported energy. To quantify these relationships, we frame the problem as a linear regression task, treating the CO2-equivalent emission coefficient as the target variables and the production shares of different energy sources as the covariates. The choice of a linear regression model is straightforward, given that production shares are percentages summing to 100% in each observation, and we assume no inherent non-linear relationship between these shares and emissions.

Finally, recognizing that time-series models often benefit from adding predictive exogenous variables, we plan to integrate insights gained from the regression model into the time-series framework. By incorporating production shares as covariates in the time-series model, we aim to improve its performance and better explain the dynamics between energy production and carbon emissions.

# 2. Data Description and Problem Analysis

## 2.1. Data description

The dataset used in this study is sourced from Statistics Finland, specifically from table [12vp](https://pxdata.stat.fi/PxWeb/pxweb/en/StatFin/StatFin__ehk/statfin_ehk_pxt_12vp.px/) and table [14qt](https://pxdata.stat.fi/PxWeb/pxweb/en/StatFin/StatFin__ehk/statfin_ehk_pxt_14qt.px/). The data was gathered using Python via API calls, followed by preprocessing steps such as merging dataframes and handling missing values.

The dataset spans 23 years, from 2000 to 2022, and contains the following features:

- $RenewableProductionShare$: The share of renewable energy in total energy production, real value in $[0, 100]$ $(\%)$
- $FossilFuelsPeatProductionShare$: The share of fossil fuels and peat in total energy production, real value in $[0, 100]$ $(\%)$
- $NuclearEnergyProductionShare$: The share of nuclear energy in total energy production, real value in $[0, 100]$ $(\%)$
- $NetImportsProductionShare$: The share of imported energy in total energy production, real value in $[0, 100]$ $(\%)$
- $OthersProductionShare$: The share of other energy sources (not classified in the above categories) in total energy production, real value in $[0, 100]$ $(\%)$

The target variable is $CO2EquivEmission$, which measures the CO2-equivalent emissions in real, non-negative values.

No additional normalization or standardization was applied, as the covariates are already expressed as percentages and the target variable is directly interpretable.

## 2.2. Problem Analysis

Despite the public availability of this dataset, we are not aware of any existing studies or analyses specifically examining Finlandâ€™s CO2-equivalent emission coefficient in relation to energy production shares. While such studies might exist, we do not actively search for them.
  
# 3. Model description

## 3.1 Model 1 - Linear Regression?

## 3.2 Model 2 - AR(1)?

## 3.3 Combination of time-series and covariates

# 4. Prior justification

Priors for all models, and justify the prior choices (informative, weakly
informative)

# 5. brms/rstanarm/Stan code

Source code for all models

# 6. MCMC inference

How the MCMC inference was run, i.e., what options were used:
- command to run MCMC inference
- a textual explanation of the choice of options

For all models

# 7. Convergence diagnosis

- R-hat convergence diagnostics
- HMC specific convergence diagnostics (divergences, tree depth)
- ESS diagnostics

Interpretation of these values.

If convergence was not good, what did we do to improve?

For all models

# 8. Posterior predictive checks

What can be interpreted? What was done if the checks indicated misspecifications?

For all models

pp_check(fit)
- include for linear regression models
- temporarily include for time-series models. TODO: confirm with TA about intuition

# 9. Predictive performance assessment

Absolute error? Relative error? Quantify performance

For all models

pp_check(fit, type = "ribbon")

R2, two options: TODO: after we finish other necessary parts of the report
- one numerical result from the mean of posterior predictive distribution -> R2
- draw from posterior, calculate R2 of the draw -> R2 distribution

# 10. Sensitivity analysis

Checking whether the result changes a lot if prior is changed

For all models

Fit with different priors, plot the posterior distributions (Exercise 2.)

# 11. Model comparison (e.g. with LOO-CV)

 TODO: LFO code and ELPD for all models

# 12. Discussion of issues and potential improvements

# 13. Conclusion what was learned from the data analysis

# 14. Self-reflection of what the group learned while making the project








